<!DOCTYPE html>
<html>
  <head>
    <!-- Styles -->
    <style>
    #chartdiv {
      width: 100%;
      height: 500px;
    }													
    </style>
  </head>
  <body>
   <h4 id="heading"></h4>
    <!-- HTML -->
    <div id="chartdiv"></div>
  </body>
  <!-- Resources -->
  <script src="https://www.amcharts.com/lib/3/amcharts.js"></script>
  <script src="https://www.amcharts.com/lib/3/serial.js"></script>
  <script src="https://www.amcharts.com/lib/3/plugins/export/export.min.js"></script>
  <link rel="stylesheet" href="https://www.amcharts.com/lib/3/plugins/export/export.css" type="text/css" media="all" />
  <script src="https://www.amcharts.com/lib/3/themes/light.js"></script>
  
  <!-- Chart code -->
  <script>
  </script>
  <script>
    function show (from , to, field) {
      var xhr = new XMLHttpRequest();
      xhr.open('GET', `./${from}.json`, true)
      xhr.responseType = 'json';
      xhr.send();
      xhr.onload = function() {
        var measurements = xhr.response.outgoing[to];
        var bars = [];
        for (var timestamp in measurements) {
console.log(timestamp, new Date(parseInt(timestamp)), typeof timestamp)
          bars.push({
            country: new Date(parseInt(timestamp)).getHours() + ':' + new Date(parseInt(timestamp)).getMinutes(),
            visits: measurements[timestamp][field],
            color: (typeof measurements[timestamp].error === 'undefined' ? '#04D215' : "#FF0F00")
          });
        }
  var chart = AmCharts.makeChart("chartdiv", {
      "theme": "light",
      "type": "serial",
      "startDuration": 2,
      "dataProvider": bars,
      "valueAxes": [{
          "position": "left",
          "axisAlpha":0,
          "gridAlpha":0
      }],
      "graphs": [{
          "balloonText": "[[category]]: <b>[[value]]</b>",
          "colorField": "color",
          "fillAlphas": 0.85,
          "lineAlpha": 0.1,
          "type": "column",
          "topRadius":1,
          "valueField": "visits"
      }],
      "depth3D": 40,
  	"angle": 30,
      "chartCursor": {
          "categoryBalloonEnabled": false,
          "cursorAlpha": 0,
          "zoomable": false
      },
      "categoryField": "country",
      "categoryAxis": {
          "gridPosition": "start",
          "axisAlpha":0,
          "gridAlpha":0
  
      },
      "export": {
      	"enabled": true
       }
  
  }, 0);
      }
      if (field === 'fee') {
        document.getElementById('heading').innerHTML = `Plotting transaction fee (cents) for sending 1 cent from ${from} to ${to}`;
      } else {
        document.getElementById('heading').innerHTML = `Plotting time (ms) for sending 1 cent from ${from} to ${to} (red means error)`;
      }
    }

    // ..
    var parts = window.location.href.split('?')[1].split(':');
    show(parts[1], parts[2], (parts[0] === 'fee' ? 'fee' : 'duration'));
  </script>

</html>
